<aura:component implements="force:hasRecordId,flexipage:availableForAllPageTypes" controller="GiftEntryFormController">
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <aura:attribute name="recordId" type="String" />
    <aura:attribute name="diIndexChosen" type="Integer" default="-1" />
    <aura:attribute name="bdiLabels" type="Map" description="Labels retrieved in Apex related to Schema information." access="public"/>
    <aura:attribute name="diBatch" 
        type="npsp__DataImportBatch__c" 
        default="{sobjectType:'npsp__DataImportBatch__c'}"/>
   	<aura:attribute name="diList" 
        type="npsp__DataImport__c[]" 
        default="[]"/>
    <aura:attribute name="giftBatchModel" type="Object"/>
    
    <div class="c-container">
        <lightning:layout multipleRows="true">
            
            <lightning:layoutItem size="12">
                <header role="banner" class="header slds-p-bottom_medium">
                    <div class="slds-page-header">
                        <div class="slds-grid">
                            <div class="slds-col slds-has-flexi-truncate slds-align-middle">
                                <p>
                                <aura:if isTrue="{!v.diIndexChosen > -1}">    
                                    Currently editing: {!v.diIndexChosen}
                                    <aura:set attribute="else">
                                        Creating a new Gift.
                                    </aura:set>
                                </aura:if>
                                </p>
                                <button class="slds-button slds-button_neutral"
                                    type="button" 
                                    onclick="{!c.handleNewGift}" 
                                    data-index="{!index}">
                                    New Gift
                                </button>
                                <button class="slds-button slds-button_brand"
                                    type="button" 
                                    onclick="{!c.handleProcessBatch}" 
                                    data-index="{!index}">
                                    Process Batch
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            </lightning:layoutItem>
            
            <lightning:layoutItem size="4">
                <header role="banner" class="header slds-p-bottom_medium">
                    <div class="slds-page-header">
                        <div class="slds-grid">
                            <div class="slds-col slds-has-flexi-truncate slds-align-middle">
                                <h1>
                                    <span class="slds-page-header__title" title="Unprocessed Gifts">
                                        <h1>Unprocessed Gifts</h1>
                                    </span>
                                </h1>
                            </div>
                        </div>
                    </div>
                </header>
                <aura:iteration var="di" items="{!v.diList}" indexVar="index">
                    <lightning:card title="{!di.npsp__Donation_Name__c}" 
                                    iconName="standard:opportunity"
                                    class="slds-m-bottom_small">
                        <aura:set attribute="actions">
                            <button class="slds-button slds-button_neutral"
                                    type="button" 
                                    onclick="{!c.handleEdit}" 
                                    data-index="{!index}">
                                Edit
                            </button>
                            <button class="slds-button slds-button_destructive"
                                    type="button" 
                                    onclick="{!c.handleDelete}" 
                                    data-index="{!index}">
                                Delete
                            </button>
                        </aura:set>
                        <div class="slds-p-around_small">
                            <lightning:recordForm
                                recordId="{!di.Id}" 
                                objectApiName="npsp__DataImport__c" 
                                layoutType="Compact" 
                                columns="2"
                                mode="readonly" />
                        </div>
                    </lightning:card>
                </aura:iteration>
            </lightning:layoutItem>
            
            <lightning:layoutItem class="slds-p-left_small" size="8">
                <c:giftEntryForm diList="{!v.diList}" 
                    diBatchId="{!v.recordId}" 
                    diIndexChosen="{!v.diIndexChosen}" />
            </lightning:layoutItem>
            
        </lightning:layout>
    </div>
	
</aura:component>